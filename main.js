const defaultAlphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_.";let cipherTableArray=[],warningActive=!1;function pageLoad(){resetAlphabet()}function resetAlphabet(){document.getElementById("keyedAlphabet").textContent=defaultAlphabet;for(let e=0;e<defaultAlphabet.length;e++)document.getElementById("t"+e).textContent=defaultAlphabet[e]}function getKey(e){let t=document.getElementById("keyBox").value;if(document.getElementById("useBase64").checked){t=btoa(t).replace(/=/g,"").replace(/\//g,".").replace(/\+/g,"_")}return e=(t.split("").filter((e,t,n)=>n.indexOf(e)===t).join("")+defaultAlphabet).split("").filter((e,t,n)=>n.indexOf(e)===t).join(""),document.getElementById("keyedAlphabet").textContent=e,e}function getKeyYX(e){for(let t=0;t<e.length;t++){let n=t%8,l=Math.floor(t/8);l="000".substr(l.toString(2).length)+l.toString(2),n="000".substr(n.toString(2).length)+n.toString(2),cipherTableArray[t]=l.concat(n),document.getElementById("t"+t).textContent=e.charAt(t)}}function getInputYX(e,t,n){for(i=0;i<e.length;i++){currentCharPosInKey=t.indexOf(e.charAt(i));let l=Math.floor(currentCharPosInKey/8),o=currentCharPosInKey%8;l="000".substr(l.toString(2).length)+l.toString(2),o="000".substr(o.toString(2).length)+o.toString(2);let d="";for(z=0;z<3;z++)d+=l.charAt(z).concat(o.charAt(z));n+=d}return n}function shuffle(e){var t=e.split("");return t.sort(function(){return.5-Math.random()}),e=t.join("")}function hashValue(e){var t,n=e.length,l="xcFVXHSJRg2BkM5P0i4oYdZpODNGth6ajAq3Ur_uQWvwEIfe9KbCTzm.7nyl1s8L",o="xcFVXHSJRg2BkM5P0i4oYdZpODNGth6ajAq3Ur_uQWvwEIfe9KbCTzm.7nyl1s8L",d="",u=0;for(i=0;i<n;i++)u+=o.indexOf(e.charAt(i))*(i+1);for(u+=331,i=0;i<64;i++)d+=t=l.charAt((o.indexOf(e.charAt(i%n))+(u*(71-i)+i)*n+1)%l.length),l=l.replaceAll(t,"");d=d.split("").reverse().join("");var c="";for(i=0;i<d.length/2;i++)c+=d.charAt(i)+d.charAt(i+d.length/2);return e=c}document.getElementById("encrypt").onclick=function(){document.getElementById("groupSizeM").checked&&""==document.getElementById("multiGroupSize").value&&(document.getElementById("multiGroupSize").value="5,7,6",document.getElementById("warningMessage").style.display="inherit",document.getElementById("warningMessageText").innerHTML=" Group sizes not entered. Defaulted to '<b>5,7,6</b>'.",setTimeout(()=>{document.getElementById("warningMessage").style.display="none"},6e3));let e=getKey(void 0);getKeyYX(e);let t=document.getElementById("inputBox").value;if(t=t.replaceAll(" ","_"),document.getElementById("stream").checked){var n="",l=hashValue(e),o=l;for(g=0;g<t.length;g++)n+=l.charAt((64-(o.indexOf(t.charAt(g))-defaultAlphabet.indexOf(o.charAt(g%64))))%64),(g+1)%64==0&&(l=o=hashValue((o=o.substring(1)+o.charAt(0)).substring(0,6+(g+defaultAlphabet.indexOf(o.charAt(0)))%13)));t=n}if(document.getElementById("filler").checked){let e,n=t.length;if(t=t.split(""),document.getElementById("groupSizeS").checked)for(e=document.getElementById("singleGroupSize").value,b=1;b<=n/(e-1);b++)t.splice(b*(e-1)+b-1,0,defaultAlphabet.charAt(Math.floor(63*Math.random())));else if(document.getElementById("groupSizeM").checked){let l=(e=document.getElementById("multiGroupSize").value.split(",")).length,o=0;for(c=0;c<n&&(t.splice(o+Number(e[c%l])-1,0,defaultAlphabet.charAt(Math.floor(63*Math.random()))),!((o+=Number(e[c%l]))+Number(e[(c+1)%l])>n+c+2));c++);}t=t.join("")}let d,u="";u=getInputYX(t,e,u),document.getElementById("groupSizeS").checked?d=document.getElementById("singleGroupSize").value:document.getElementById("groupSizeM").checked&&(d=document.getElementById("multiGroupSize").value.split(","));let a=d.length,m=u,y=0;for(;m.length>0;)m=m.substring(6*d[y%a]),y++;let h=[];if(document.getElementById("groupSizeS").checked){for(i=0;i<u.length/(6*d);i++)if(h[i]=u.substr(i*d*6,6*d),i===y-1&&h[i].length<6*d){let e=h[i].length;for(x=0;x<6*d-e;x++)h[i]+=Math.round(Math.random())}}else if(document.getElementById("groupSizeM").checked){let e=0;for(i=0;i<y;i++)if(h[i]=u.substr(e,6*d[i%d.length]),e+=6*d[i%d.length],i===y-1&&h[i].length<6*d[i%d.length]){let e=h[i].length;for(x=0;x<6*d[i%d.length]-e;x++)h[i]+=Math.round(Math.random())}}let s=[];for(i=0;i<h.length;i++)for(s[i]=[],q=0;q<6;q++)for(p=0;p<h[i].length;p++)p%6===q&&(s[i]+=h[i].charAt(p));let B=s.join(""),f=[];for(i=0;i<B.length/6;i++)f[i]=B.substr(6*i,6);let I="";for(i=0;i<f.length;i++){let t=f[i],n="",l="";for(r=0;r<3;r++)n+=t.toString().charAt(2*r),l+=t.toString().charAt(2*r+1);t=n.concat(l),I+=e.charAt(cipherTableArray.indexOf(t))}let E="";for(i=0;i<I.length;i++)E+=(I.charCodeAt(i).toString(10)^e.charCodeAt(i%e.length).toString(10)).toString(16);document.getElementById("outputBox").value=I,document.getElementById("tableLocation").textContent="",document.getElementById("tableLocation").style.display="none"},document.getElementById("decrypt").onclick=function(){document.getElementById("groupSizeM").checked&&""==document.getElementById("multiGroupSize").value&&(document.getElementById("multiGroupSize").value="5,7,6",document.getElementById("warningMessage").style.display="inherit",document.getElementById("warningMessageText").innerHTML=" Group sizes not entered. Defaulted to '<b>5,7,6</b>'.",setTimeout(()=>{document.getElementById("warningMessage").style.display="none"},6e3));let e=getKey(void 0);getKeyYX(e);let t,n=document.getElementById("inputBox").value,l="";l=getInputYX(n=n.replaceAll(" ","_"),e,l),document.getElementById("groupSizeS").checked?t=document.getElementById("singleGroupSize").value:document.getElementById("groupSizeM").checked&&(t=document.getElementById("multiGroupSize").value.split(","));let o=t.length,d=l,u=0;for(;d.length>0;)d=d.substring(6*t[u%o]),u++;let c=[];if(document.getElementById("groupSizeS").checked)for(i=0;i<l.length/(6*t);i++)c[i]=l.substr(i*t*6,6*t);else if(document.getElementById("groupSizeM").checked){let e=0;for(i=0;i<u;i++)c[i]=l.substr(e,6*t[i%t.length]),e+=6*t[i%t.length]}let a=[];for(i=0;i<c.length;i++)for(a[i]=[],q=0;q<c[i].length/6;q++)for(p=0;p<c[i].length;p++)p%(c[i].length/6)===q&&(a[i]+=c[i].charAt(p));let m=a.join(""),y=[];for(i=0;i<m.length/6;i++)y[i]=m.substr(6*i,6);let h="";for(i=0;i<y.length;i++){let t=y[i],n="",l="";for(r=0;r<3;r++)n+=t.toString().charAt(2*r),l+=t.toString().charAt(2*r+1);t=n.concat(l),h+=e.charAt(cipherTableArray.indexOf(t))}if(document.getElementById("filler").checked){let e,t=0,n=[];if(document.getElementById("groupSizeS").checked){for(e=document.getElementById("singleGroupSize").value;t<h.length;)n.push(h.substring(t,t+Number(e)-1)),t+=Number(e);h=n.join("")}else if(document.getElementById("groupSizeM").checked){let l=(e=document.getElementById("multiGroupSize").value.split(",")).length,o=0;for(;t<h.length;)n.push(h.substring(t,t+Number(e[o%l])-1)),t+=Number(e[o%l]),o++;h=n.join("")}}if(document.getElementById("stream").checked){var s="",B=hashValue(e),f=B;for(g=0;g<h.length;g++)s+=B.charAt((64-(f.indexOf(h.charAt(g))-defaultAlphabet.indexOf(f.charAt(g%64))))%64),(g+1)%64==0&&(B=f=hashValue((f=f.substring(1)+f.charAt(0)).substring(0,6+(g+defaultAlphabet.indexOf(f.charAt(0)))%13)));h=s}h=h.replaceAll("_"," "),document.getElementById("outputBox").value=h,document.getElementById("tableLocation").textContent="",document.getElementById("tableLocation").style.display="none"},document.getElementById("copyText").onclick=function(){var e=document.getElementById("outputBox"),t=document.createElement("textarea");t.value=e.value,document.body.appendChild(t),t.select(),document.execCommand("Copy"),t.remove()},document.getElementById("clearText").onclick=function(){0==warningActive&&(document.getElementById("keyBox").value=""),document.getElementById("inputBox").value="",document.getElementById("outputBox").value="",document.getElementById("charCount").textContent="",document.getElementById("tableLocation").textContent="",document.getElementById("tableLocation").style.display="none",document.getElementById("inputBox").style.background="white",document.getElementById("sanitize").style.outline="none",resetAlphabet()},document.getElementById("randomKey").onclick=function(){if(0==warningActive){var e=defaultAlphabet;e=shuffle(e),document.getElementById("keyBox").value=e}},document.getElementById("inputBox").oninput=function(){document.getElementById("charCount").textContent="Character count: "+this.value.length,document.getElementById("charCount").style.display="inherit";let e=document.getElementById("inputBox").value;e.length>0&&/[^a-zA-Z0-9\_\ \.]/.test(e)?(document.getElementById("inputBox").style.background="linear-gradient(180deg, rgba(255,0,0,0.2) 0%, rgba(255,255,255,0) 100%)",document.getElementById("sanitize").style.outline="2px solid red"):(document.getElementById("inputBox").style.background="white",document.getElementById("sanitize").style.outline="none")},document.getElementById("sanitize").onclick=function(){var e=document.getElementById("inputBox").value;document.getElementById("inputBox").value=e.replace(/[?!]/g,".").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,\-\/:;<=>@\[\]^`{|}~]/g,"").replace(/\s+/g," "),document.getElementById("inputBox").style.background="white",document.getElementById("sanitize").style.outline="none",document.getElementById("charCount").textContent="Character count: "+document.getElementById("inputBox").value.length},document.getElementById("cipherTableMatrix").onclick=(e=>{if(e.target.id){let t=e.target.id;clickedCharIndex=t.replace("t",""),t=document.getElementById("keyedAlphabet").textContent.charAt(clickedCharIndex);let n=Math.floor(clickedCharIndex/8),l=clickedCharIndex%8;n="000".substr(n.toString(2).length)+n.toString(2),l="000".substr(l.toString(2).length)+l.toString(2);let o="";for(z=0;z<3;z++)o+=n.charAt(z).concat(l.charAt(z));document.getElementById("tableLocation").textContent='Location of "'+t+'" = '+o,document.getElementById("tableLocation").style.display="inherit"}}),document.getElementById("genKey").onclick=function(){if(0==warningActive)if(""==document.getElementById("keyBox").value)document.getElementById("keyBox").style.background="linear-gradient(180deg, rgba(255,0,0,0.2) 0%, rgba(255,255,255,0) 100%)",document.getElementById("keyBox").style.textAlign="center",document.getElementById("keyBox").style.color="#333333",document.getElementById("keyBox").value="Please enter a key first.",document.getElementById("keyBox").disabled=!0,document.getElementById("keyBox").style.pointerEvents="none",warningActive=!0,setTimeout(()=>{document.getElementById("keyBox").style.background="white",document.getElementById("keyBox").value="",document.getElementById("keyBox").style.textAlign="left",document.getElementById("keyBox").style.color="black",document.getElementById("keyBox").disabled=!1,document.getElementById("keyBox").style.pointerEvents="auto",warningActive=!1},2500);else{var e=document.getElementById("keyBox").value;document.getElementById("keyBox").value=hashValue(e)}},document.getElementById("warningButton").onclick=function(){document.getElementById("warningMessage").style.display="none"};
