let defaultAlphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_.",cipherTableArray=[];function pageLoad(){resetAlphabet()}function resetAlphabet(){document.getElementById("keyedAlphabet").textContent=defaultAlphabet;for(let e=0;e<defaultAlphabet.length;e++)document.getElementById("t"+e).textContent=defaultAlphabet[e]}function getKey(e){let t=document.getElementById("keyBox").value;if(document.getElementById("useBase64").checked){t=btoa(t).replace(/=/g,"").replace(/\//g,".").replace(/\+/g,"_")}return e=(t.split("").filter((e,t,n)=>n.indexOf(e)===t).join("")+defaultAlphabet).split("").filter((e,t,n)=>n.indexOf(e)===t).join(""),document.getElementById("keyedAlphabet").textContent=e,e}function getKeyYX(e){for(let t=0;t<e.length;t++){let n=t%8,l=Math.floor(t/8);l="000".substr(l.toString(2).length)+l.toString(2),n="000".substr(n.toString(2).length)+n.toString(2),cipherTableArray[t]=l.concat(n),document.getElementById("t"+t).textContent=e.charAt(t)}}function getInputYX(e,t,n){for(i=0;i<e.length;i++){currentCharPosInKey=t.indexOf(e.charAt(i));let l=Math.floor(currentCharPosInKey/8),o=currentCharPosInKey%8;l="000".substr(l.toString(2).length)+l.toString(2),o="000".substr(o.toString(2).length)+o.toString(2);let r="";for(z=0;z<3;z++)r+=l.charAt(z).concat(o.charAt(z));n+=r}return n}function shuffle(e){var t=e.split("");return t.sort(function(){return.5-Math.random()}),e=t.join("")}document.getElementById("encrypt").onclick=function(){let e=getKey(void 0);getKeyYX(e);let t=document.getElementById("inputBox").value;if(t=t.replaceAll(" ","_"),document.getElementById("filler").checked){let e,n=t.length;if(t=t.split(""),document.getElementById("groupSizeS").checked)for(e=document.getElementById("singleGroupSize").value,b=1;b<=n/(e-1);b++)t.splice(b*(e-1)+b-1,0,defaultAlphabet.charAt(Math.floor(63*Math.random())));else if(document.getElementById("groupSizeM").checked){let l=(e=document.getElementById("multiGroupSize").value.split(",")).length,o=0;for(c=0;c<n&&(t.splice(parseInt(o,10)+parseInt(e[c%l],10)-1,0,defaultAlphabet.charAt(Math.floor(63*Math.random()))),!((o+=1*e[c%l])+parseInt(e[(c+1)%l],10)>n+c+2));c++);}t=t.join("")}let n,l="";l=getInputYX(t,e,l),document.getElementById("groupSizeS").checked?n=document.getElementById("singleGroupSize").value:document.getElementById("groupSizeM").checked&&(n=document.getElementById("multiGroupSize").value.split(","));let o=n.length,u=l,d=0;for(;u.length>0;)u=u.substring(6*n[d%o]),d++;let a=[];if(document.getElementById("groupSizeS").checked){for(i=0;i<l.length/(6*n);i++)if(a[i]=l.substr(i*n*6,6*n),i===d-1&&a[i].length<6*n){let e=a[i].length;for(x=0;x<6*n-e;x++)a[i]+=Math.round(Math.random())}}else if(document.getElementById("groupSizeM").checked){let e=0;for(i=0;i<d;i++)if(a[i]=l.substr(e,6*n[i%n.length]),e+=6*n[i%n.length],i===d-1&&a[i].length<6*n[i%n.length]){let e=a[i].length;for(x=0;x<6*n[i%n.length]-e;x++)a[i]+=Math.round(Math.random())}}let g=[];for(i=0;i<a.length;i++)for(g[i]=[],q=0;q<6;q++)for(p=0;p<a[i].length;p++)p%6===q&&(g[i]+=a[i].charAt(p));let m=g.join(""),h=[];for(i=0;i<m.length/6;i++)h[i]=m.substr(6*i,6);let y="";for(i=0;i<h.length;i++){let t=h[i],n="",l="";for(r=0;r<3;r++)n+=t.toString().charAt(2*r),l+=t.toString().charAt(2*r+1);t=n.concat(l),y+=e.charAt(cipherTableArray.indexOf(t))}let f="";for(i=0;i<y.length;i++)f+=(y.charCodeAt(i).toString(10)^e.charCodeAt(i%e.length).toString(10)).toString(16);document.getElementById("outputBox").value=y,document.getElementById("tableLocation").textContent="",document.getElementById("tableLocation").style.display="none"},document.getElementById("decrypt").onclick=function(){let e=getKey(void 0);getKeyYX(e);let t,n=document.getElementById("inputBox").value,l="";l=getInputYX(n=n.replaceAll(" ","_"),e,l),document.getElementById("groupSizeS").checked?t=document.getElementById("singleGroupSize").value:document.getElementById("groupSizeM").checked&&(t=document.getElementById("multiGroupSize").value.split(","));let o=t.length,c=l,u=0;for(;c.length>0;)c=c.substring(6*t[u%o]),u++;let d=[];if(document.getElementById("groupSizeS").checked)for(i=0;i<l.length/(6*t);i++)d[i]=l.substr(i*t*6,6*t);else if(document.getElementById("groupSizeM").checked){let e=0;for(i=0;i<u;i++)d[i]=l.substr(e,6*t[i%t.length]),e+=6*t[i%t.length]}let a=[];for(i=0;i<d.length;i++)for(a[i]=[],q=0;q<d[i].length/6;q++)for(p=0;p<d[i].length;p++)p%(d[i].length/6)===q&&(a[i]+=d[i].charAt(p));let g=a.join(""),m=[];for(i=0;i<g.length/6;i++)m[i]=g.substr(6*i,6);let h="";for(i=0;i<m.length;i++){let t=m[i],n="",l="";for(r=0;r<3;r++)n+=t.toString().charAt(2*r),l+=t.toString().charAt(2*r+1);t=n.concat(l),h+=e.charAt(cipherTableArray.indexOf(t))}if(h=h.replaceAll("_"," "),document.getElementById("filler").checked){let e,t=0,n=[];if(document.getElementById("groupSizeS").checked){for(e=document.getElementById("singleGroupSize").value;t<h.length;)n.push(h.substring(t,t+parseInt(e,10)-1)),t+=parseInt(e,10);h=n.join("")}else if(document.getElementById("groupSizeM").checked){let l=(e=document.getElementById("multiGroupSize").value.split(",")).length,o=0;for(;t<h.length;)n.push(h.substring(t,t+parseInt(e[o%l],10)-1)),t+=parseInt(e[o%l],10),o++;h=n.join("")}}document.getElementById("outputBox").value=h,document.getElementById("tableLocation").textContent="",document.getElementById("tableLocation").style.display="none"},document.getElementById("copyText").onclick=function(){var e=document.getElementById("outputBox"),t=document.createElement("textarea");t.value=e.value,document.body.appendChild(t),t.select(),document.execCommand("Copy"),t.remove()},document.getElementById("clearText").onclick=function(){document.getElementById("keyBox").value="",document.getElementById("inputBox").value="",document.getElementById("outputBox").value="",document.getElementById("charCount").textContent="",document.getElementById("tableLocation").textContent="",document.getElementById("tableLocation").style.display="none",resetAlphabet()},document.getElementById("randomKey").onclick=function(){var e=defaultAlphabet;e=shuffle(e),document.getElementById("keyBox").value=e},document.getElementById("inputBox").onkeyup=function(){document.getElementById("charCount").textContent="Character count: "+this.value.length,document.getElementById("charCount").style.display="inherit"},document.getElementById("sanitize").onclick=function(){var e=document.getElementById("inputBox").value;document.getElementById("inputBox").value=e.replace(/[?!]/g,".").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,\-\/:;<=>@\[\]^`{|}~]/g,"").replace(/\s+/g," ")},document.getElementById("cipherTableMatrix").onclick=(e=>{if(e.target.id){let t=e.target.id;clickedCharIndex=t.replace("t",""),t=document.getElementById("keyedAlphabet").textContent.charAt(clickedCharIndex);let n=Math.floor(clickedCharIndex/8),l=clickedCharIndex%8;n="000".substr(n.toString(2).length)+n.toString(2),l="000".substr(l.toString(2).length)+l.toString(2);let o="";for(z=0;z<3;z++)o+=n.charAt(z).concat(l.charAt(z));document.getElementById("tableLocation").textContent='Location of "'+t+'" = '+o,document.getElementById("tableLocation").style.display="inherit"}});