let defaultAlphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_.",cipherTableArray=[];function pageLoad(){resetAlphabet()}function resetAlphabet(){document.getElementById("keyedAlphabet").textContent=defaultAlphabet;for(let e=0;e<defaultAlphabet.length;e++)document.getElementById("t"+e).textContent=defaultAlphabet[e]}function getKey(e){let t=document.getElementById("keyBox").value;if(document.getElementById("useBase64").checked){t=btoa(t).replace(/=/g,"").replace(/\//g,".").replace(/\+/g,"_")}return e=(t.split("").filter(((e,t,n)=>n.indexOf(e)===t)).join("")+defaultAlphabet).split("").filter(((e,t,n)=>n.indexOf(e)===t)).join(""),document.getElementById("keyedAlphabet").textContent=e,e}function getKeyYX(e){for(let t=0;t<e.length;t++){let n=t%8,l=Math.floor(t/8);l="000".substr(l.toString(2).length)+l.toString(2),n="000".substr(n.toString(2).length)+n.toString(2),cipherTableArray[t]=l.concat(n),document.getElementById("t"+t).textContent=e.charAt(t)}}function getInputYX(e,t,n){for(i=0;i<e.length;i++){currentCharPosInKey=t.indexOf(e.charAt(i));let l=Math.floor(currentCharPosInKey/8),o=currentCharPosInKey%8;l="000".substr(l.toString(2).length)+l.toString(2),o="000".substr(o.toString(2).length)+o.toString(2);let d="";for(z=0;z<3;z++)d+=l.charAt(z).concat(o.charAt(z));n+=d}return n}function shuffle(e){var t=e.split("");return t.sort((function(){return.5-Math.random()})),e=t.join("")}document.getElementById("encrypt").onclick=function(){document.getElementById("groupSizeM").checked&&""==document.getElementById("multiGroupSize").value&&(document.getElementById("multiGroupSize").value="5,7,6",document.getElementById("warningMessage").style.display="inherit",document.getElementById("warningMessageText").innerHTML=" Group sizes not entered. Defaulted to '<b>5,7,6</b>'.",setTimeout((()=>{document.getElementById("warningMessage").style.display="none"}),6e3));let e=getKey(undefined);getKeyYX(e);let t=document.getElementById("inputBox").value;if(t=t.replaceAll(" ","_"),document.getElementById("stream").checked){var n="",l=e;for(g=0;g<t.length;g++)n+=l.charAt((64-(e.indexOf(t.charAt(g))-defaultAlphabet.indexOf(e.charAt(g%64))))%64),g>0&&(g+1)%64==0&&(l=l.substring(1)+l.charAt(0));t=n}if(document.getElementById("filler").checked){let e,n=t.length;if(t=t.split(""),document.getElementById("groupSizeS").checked)for(e=document.getElementById("singleGroupSize").value,b=1;b<=n/(e-1);b++)t.splice(b*(e-1)+b-1,0,defaultAlphabet.charAt(Math.floor(63*Math.random())));else if(document.getElementById("groupSizeM").checked){e=document.getElementById("multiGroupSize").value.split(",");let l=e.length,o=0;for(c=0;c<n&&(t.splice(parseInt(o,10)+parseInt(e[c%l],10)-1,0,defaultAlphabet.charAt(Math.floor(63*Math.random()))),o+=1*e[c%l],!(o+parseInt(e[(c+1)%l],10)>n+c+2));c++);}t=t.join("")}let o,d="";d=getInputYX(t,e,d),document.getElementById("groupSizeS").checked?o=document.getElementById("singleGroupSize").value:document.getElementById("groupSizeM").checked&&(o=document.getElementById("multiGroupSize").value.split(","));let u=o.length,a=d,m=0;for(;a.length>0;)a=a.substring(6*o[m%u]),m++;let y=[];if(document.getElementById("groupSizeS").checked){for(i=0;i<d.length/(6*o);i++)if(y[i]=d.substr(i*o*6,6*o),i===m-1&&y[i].length<6*o){let e=y[i].length;for(x=0;x<6*o-e;x++)y[i]+=Math.round(Math.random())}}else if(document.getElementById("groupSizeM").checked){let e=0;for(i=0;i<m;i++)if(y[i]=d.substr(e,6*o[i%o.length]),e+=6*o[i%o.length],i===m-1&&y[i].length<6*o[i%o.length]){let e=y[i].length;for(x=0;x<6*o[i%o.length]-e;x++)y[i]+=Math.round(Math.random())}}let h=[];for(i=0;i<y.length;i++)for(h[i]=[],q=0;q<6;q++)for(p=0;p<y[i].length;p++)p%6===q&&(h[i]+=y[i].charAt(p));let s=h.join(""),B=[];for(i=0;i<s.length/6;i++)B[i]=s.substr(6*i,6);let I="";for(i=0;i<B.length;i++){let t=B[i],n="",l="";for(r=0;r<3;r++)n+=t.toString().charAt(2*r),l+=t.toString().charAt(2*r+1);t=n.concat(l),I+=e.charAt(cipherTableArray.indexOf(t))}let f="";for(i=0;i<I.length;i++)f+=(I.charCodeAt(i).toString(10)^e.charCodeAt(i%e.length).toString(10)).toString(16);document.getElementById("outputBox").value=I,document.getElementById("tableLocation").textContent="",document.getElementById("tableLocation").style.display="none"},document.getElementById("decrypt").onclick=function(){document.getElementById("groupSizeM").checked&&""==document.getElementById("multiGroupSize").value&&(document.getElementById("multiGroupSize").value="5,7,6",document.getElementById("warningMessage").style.display="inherit",document.getElementById("warningMessageText").innerHTML=" Group sizes not entered. Defaulted to '<b>5,7,6</b>'.",setTimeout((()=>{document.getElementById("warningMessage").style.display="none"}),6e3));let e=getKey(undefined);getKeyYX(e);let t=document.getElementById("inputBox").value;t=t.replaceAll(" ","_");let n,l="";l=getInputYX(t,e,l),document.getElementById("groupSizeS").checked?n=document.getElementById("singleGroupSize").value:document.getElementById("groupSizeM").checked&&(n=document.getElementById("multiGroupSize").value.split(","));let o=n.length,d=l,c=0;for(;d.length>0;)d=d.substring(6*n[c%o]),c++;let u=[];if(document.getElementById("groupSizeS").checked)for(i=0;i<l.length/(6*n);i++)u[i]=l.substr(i*n*6,6*n);else if(document.getElementById("groupSizeM").checked){let e=0;for(i=0;i<c;i++)u[i]=l.substr(e,6*n[i%n.length]),e+=6*n[i%n.length]}let a=[];for(i=0;i<u.length;i++)for(a[i]=[],q=0;q<u[i].length/6;q++)for(p=0;p<u[i].length;p++)p%(u[i].length/6)===q&&(a[i]+=u[i].charAt(p));let m=a.join(""),y=[];for(i=0;i<m.length/6;i++)y[i]=m.substr(6*i,6);let h="";for(i=0;i<y.length;i++){let t=y[i],n="",l="";for(r=0;r<3;r++)n+=t.toString().charAt(2*r),l+=t.toString().charAt(2*r+1);t=n.concat(l),h+=e.charAt(cipherTableArray.indexOf(t))}if(document.getElementById("filler").checked){let e,t=0,n=[];if(document.getElementById("groupSizeS").checked){for(e=document.getElementById("singleGroupSize").value;t<h.length;)n.push(h.substring(t,t+parseInt(e,10)-1)),t+=parseInt(e,10);h=n.join("")}else if(document.getElementById("groupSizeM").checked){e=document.getElementById("multiGroupSize").value.split(",");let l=e.length,o=0;for(;t<h.length;)n.push(h.substring(t,t+parseInt(e[o%l],10)-1)),t+=parseInt(e[o%l],10),o++;h=n.join("")}}if(document.getElementById("stream").checked){var s="",B=e;for(g=0;g<h.length;g++)s+=B.charAt((64-(e.indexOf(h.charAt(g))-defaultAlphabet.indexOf(e.charAt(g%64))))%64),g>0&&(g+1)%64==0&&(B=B.substring(1)+B.charAt(0));h=s}h=h.replaceAll("_"," "),document.getElementById("outputBox").value=h,document.getElementById("tableLocation").textContent="",document.getElementById("tableLocation").style.display="none"},document.getElementById("copyText").onclick=function(){var e=document.getElementById("outputBox"),t=document.createElement("textarea");t.value=e.value,document.body.appendChild(t),t.select(),document.execCommand("Copy"),t.remove()},document.getElementById("clearText").onclick=function(){document.getElementById("keyBox").value="",document.getElementById("inputBox").value="",document.getElementById("outputBox").value="",document.getElementById("charCount").textContent="",document.getElementById("tableLocation").textContent="",document.getElementById("tableLocation").style.display="none",document.getElementById("inputBox").style.background="white",document.getElementById("sanitize").style.outline="none",resetAlphabet()},document.getElementById("randomKey").onclick=function(){var e=defaultAlphabet;e=shuffle(e),document.getElementById("keyBox").value=e},document.getElementById("inputBox").oninput=function(){document.getElementById("charCount").textContent="Character count: "+this.value.length,document.getElementById("charCount").style.display="inherit";let e=document.getElementById("inputBox").value;e.length>0&&/[^a-zA-Z0-9\_\ \.]/.test(e)?(document.getElementById("inputBox").style.background="linear-gradient(180deg, rgba(255,0,0,0.2) 0%, rgba(255,255,255,0) 100%)",document.getElementById("sanitize").style.outline="2px solid red"):(document.getElementById("inputBox").style.background="white",document.getElementById("sanitize").style.outline="none")},document.getElementById("sanitize").onclick=function(){var e=document.getElementById("inputBox").value;document.getElementById("inputBox").value=e.replace(/[?!]/g,".").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,\-\/:;<=>@\[\]^`{|}~]/g,"").replace(/\s+/g," "),document.getElementById("inputBox").style.background="white",document.getElementById("sanitize").style.outline="none",document.getElementById("charCount").textContent="Character count: "+document.getElementById("inputBox").value.length},document.getElementById("cipherTableMatrix").onclick=e=>{if(e.target.id){let t=e.target.id;clickedCharIndex=t.replace("t",""),t=document.getElementById("keyedAlphabet").textContent.charAt(clickedCharIndex);let n=Math.floor(clickedCharIndex/8),l=clickedCharIndex%8;n="000".substr(n.toString(2).length)+n.toString(2),l="000".substr(l.toString(2).length)+l.toString(2);let o="";for(z=0;z<3;z++)o+=n.charAt(z).concat(l.charAt(z));document.getElementById("tableLocation").textContent='Location of "'+t+'" = '+o,document.getElementById("tableLocation").style.display="inherit"}},document.getElementById("genKey").onclick=function(){if(""==document.getElementById("keyBox").value)document.getElementById("keyBox").style.background="linear-gradient(180deg, rgba(255,0,0,0.2) 0%, rgba(255,255,255,0) 100%)",document.getElementById("keyBox").style.textAlign="center",document.getElementById("keyBox").style.color="#333333",document.getElementById("keyBox").value="Please enter a key first.",document.getElementById("keyBox").disabled=!0,document.getElementById("keyBox").style.pointerEvents="none",setTimeout((()=>{document.getElementById("keyBox").style.background="white",document.getElementById("keyBox").value="",document.getElementById("keyBox").style.textAlign="left",document.getElementById("keyBox").style.color="black",document.getElementById("keyBox").disabled=!1,document.getElementById("keyBox").style.pointerEvents="auto"}),2500);else{var e,t=document.getElementById("keyBox").value,n=t.length,l="xcFVXHSJRg2BkM5P0i4oYdZpODNGth6ajAq3Ur_uQWvwEIfe9KbCTzm.7nyl1s8L",o="xcFVXHSJRg2BkM5P0i4oYdZpODNGth6ajAq3Ur_uQWvwEIfe9KbCTzm.7nyl1s8L",d="",c=0;for(i=0;i<n;i++)c+=o.indexOf(t.charAt(i))*(i+1);for(c+=331,i=0;i<64;i++)d+=e=l.charAt((o.indexOf(t.charAt(i%n))+(c*(71-i)+i)*n+1)%l.length),l=l.replaceAll(e,"");d=d.split("").reverse().join("");var u="";for(i=0;i<d.length/2;i++)u+=d.charAt(i)+d.charAt(i+d.length/2);document.getElementById("keyBox").value=u}},document.getElementById("warningButton").onclick=function(){document.getElementById("warningMessage").style.display="none"};